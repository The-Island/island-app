<%
  var gravatar = 'https://www.gravatar.com/avatar/'
      + this.model.get('author').gravatar + '?s=48&d='
      + encodeURIComponent(this.app.images.avatar);
  var weather = this.model.get('weather');
  var daily = weather.get('daily');
%>

<% if (!this.parentView) { %>
  <div class="leftside">
<% } %>

<% if (this.parentView) { %>
  <a href="/sessions/<%= this.model.get('key') %>" class="navigate">
    <div class="mini-map" id="crag_map_<%= this.model.id %>"><div class="mini-map-cover"></div></div>
  </a>
  <div class="event-title">
    <a href="/<%= this.model.get('author').username %>" class="title navigate">
      <%= this.model.formatAuthorFor(this.app.profile.member) %></a> logged 
      <a href="/sessions/<%= this.model.get('key') %>" class="title navigate">climbing</a>.
    <a href="/crags/<%= this.model.get('crag').key %>" class="session-location title navigate">
      <i class="icon-location"></i> <%= this.model.get('crag').name %>, <%= this.model.get('crag').country %>
    </a>
  </div>
  <% if (daily) { %>
    <span class="event-title-text">
      <span class="event-timeline-label">
        <i class="icon-temperatire"></i>
      </span>
      <a href="/sessions/<%= this.model.get('key') %>" class="title-medium navigate">
        <%= weather.dailyTempRange() %>&degC <%= weather.getWeatherIconName(daily.icon) %>
      </a>
    </span>
  <% } %>
<% } %>
<% if (this.model.get('actions').length === 0) { %>
  <span class="session-empty">No activities</span>
<% } %>
<% _.each(this.model.get('actions'), _.bind(function (a) { %>
  <% if (a.ticks.length > 0) { %>
    <%= this.renderActivity(a) %>
  <% } %>
<% }, this)); %>
<% if (!this.parentView) { %>
  </div>
  <div class="rightside">
    <div class="mini-map" id="session_map_<%= this.model.id %>"></div>
    <% if (daily) { %>
      <table class="session-weather">
        <tr>
          <th colspan="2"><i class="icon-temperatire"></i> <%= new Date(this.model.get('date')).format('dddd, mmm d, yyyy') %></th>
        </tr>
        <tr>
          <td colspan="2"><%= daily.summary %></td>
        </tr>
        <tr>
          <td>low temp.</td>
          <td><%= weather.tempFtoC(daily.temperatureMin) %>&degC @ <%= new Date(daily.temperatureMinTime * 1000).format('h:MM TT') %></td>
        </tr>
        <tr>
          <td>high temp.</td>
          <td><%= weather.tempFtoC(daily.temperatureMax) %>&degC @ <%= new Date(daily.temperatureMaxTime * 1000).format('h:MM TT') %></td>
        </tr>
        <tr>
          <td>dew point</td>
          <td><%= weather.tempFtoC(daily.dewPoint) %>&degC</td>
        </tr>
        <tr>
          <td>humidity</td>
          <td><%= Math.round(daily.humidity * 100) %>%</td>
        </tr>
        <tr>
          <td>cloud cover</td>
          <td><%= Math.round(daily.cloudCover * 100) %>%</td>
        </tr>
        <tr>
          <td>wind speed</td>
          <td><%= (daily.windSpeed * 3.6).toFixed(1) %> km/hr</td>
        </tr>
        <% if (daily.precipIntensity > 0) { %>
          <tr>
            <td>precip. intensity</td>
            <td><%= daily.precipIntensity %> (<%= daily.precipType %>)</td>
          </tr>
        <% } %>
      </table>
    <% } %>
  </div>
  <div class="clear"></div>
<% } %>
