/*
 jQuery Easing v1.3: Copyright (c) 2008 George McGinley Smith | BSD License: http://www.opensource.org/licenses/bsd-license.php
 jquery.transloadit2-v2.6.2.js: Copyright (c) 2013 Transloadit Ltd | MIT License: http://www.opensource.org/licenses/mit-license.php

 Fork this on Github: http://github.com/transloadit/jquery-sdk

 Transloadit servers allow browsers to cache jquery.transloadit2.js for 1 hour.
 keep this in mind when rolling out fixes.
 json2: Douglas Crockford | Public domain
 jQuery Tools 1.2.3: Tero Piirainen | Public domain
*/
jQuery.easing.jswing=jQuery.easing.swing;
jQuery.extend(jQuery.easing,{def:"easeOutQuad",swing:function(e,a,d,b,c){return jQuery.easing[jQuery.easing.def](e,a,d,b,c)},easeInQuad:function(e,a,d,b,c){return b*(a/=c)*a+d},easeOutQuad:function(e,a,d,b,c){return-b*(a/=c)*(a-2)+d},easeInOutQuad:function(e,a,d,b,c){return 1>(a/=c/2)?b/2*a*a+d:-b/2*(--a*(a-2)-1)+d},easeInCubic:function(e,a,d,b,c){return b*(a/=c)*a*a+d},easeOutCubic:function(e,a,d,b,c){return b*((a=a/c-1)*a*a+1)+d},easeInOutCubic:function(e,a,d,b,c){return 1>(a/=c/2)?b/2*a*a*a+d:
b/2*((a-=2)*a*a+2)+d},easeInQuart:function(e,a,d,b,c){return b*(a/=c)*a*a*a+d},easeOutQuart:function(e,a,d,b,c){return-b*((a=a/c-1)*a*a*a-1)+d},easeInOutQuart:function(e,a,d,b,c){return 1>(a/=c/2)?b/2*a*a*a*a+d:-b/2*((a-=2)*a*a*a-2)+d},easeInQuint:function(e,a,d,b,c){return b*(a/=c)*a*a*a*a+d},easeOutQuint:function(e,a,d,b,c){return b*((a=a/c-1)*a*a*a*a+1)+d},easeInOutQuint:function(e,a,d,b,c){return 1>(a/=c/2)?b/2*a*a*a*a*a+d:b/2*((a-=2)*a*a*a*a+2)+d},easeInSine:function(e,a,d,b,c){return-b*Math.cos(a/
c*(Math.PI/2))+b+d},easeOutSine:function(e,a,d,b,c){return b*Math.sin(a/c*(Math.PI/2))+d},easeInOutSine:function(e,a,d,b,c){return-b/2*(Math.cos(Math.PI*a/c)-1)+d},easeInExpo:function(e,a,d,b,c){return 0==a?d:b*Math.pow(2,10*(a/c-1))+d},easeOutExpo:function(e,a,d,b,c){return a==c?d+b:b*(-Math.pow(2,-10*a/c)+1)+d},easeInOutExpo:function(e,a,d,b,c){return 0==a?d:a==c?d+b:1>(a/=c/2)?b/2*Math.pow(2,10*(a-1))+d:b/2*(-Math.pow(2,-10*--a)+2)+d},easeInCirc:function(e,a,d,b,c){return-b*(Math.sqrt(1-(a/=c)*
a)-1)+d},easeOutCirc:function(e,a,d,b,c){return b*Math.sqrt(1-(a=a/c-1)*a)+d},easeInOutCirc:function(e,a,d,b,c){return 1>(a/=c/2)?-b/2*(Math.sqrt(1-a*a)-1)+d:b/2*(Math.sqrt(1-(a-=2)*a)+1)+d},easeInElastic:function(e,a,d,b,c){e=1.70158;var g=0,h=b;if(0==a)return d;if(1==(a/=c))return d+b;g||(g=.3*c);h<Math.abs(b)?(h=b,e=g/4):e=g/(2*Math.PI)*Math.asin(b/h);return-(h*Math.pow(2,10*(a-=1))*Math.sin(2*(a*c-e)*Math.PI/g))+d},easeOutElastic:function(e,a,d,b,c){e=1.70158;var g=0,h=b;if(0==a)return d;if(1==
(a/=c))return d+b;g||(g=.3*c);h<Math.abs(b)?(h=b,e=g/4):e=g/(2*Math.PI)*Math.asin(b/h);return h*Math.pow(2,-10*a)*Math.sin(2*(a*c-e)*Math.PI/g)+b+d},easeInOutElastic:function(e,a,d,b,c){e=1.70158;var g=0,h=b;if(0==a)return d;if(2==(a/=c/2))return d+b;g||(g=.3*c*1.5);h<Math.abs(b)?(h=b,e=g/4):e=g/(2*Math.PI)*Math.asin(b/h);return 1>a?-.5*h*Math.pow(2,10*(a-=1))*Math.sin(2*(a*c-e)*Math.PI/g)+d:h*Math.pow(2,-10*(a-=1))*Math.sin(2*(a*c-e)*Math.PI/g)*.5+b+d},easeInBack:function(e,a,d,b,c,g){void 0==g&&
(g=1.70158);return b*(a/=c)*a*((g+1)*a-g)+d},easeOutBack:function(e,a,d,b,c,g){void 0==g&&(g=1.70158);return b*((a=a/c-1)*a*((g+1)*a+g)+1)+d},easeInOutBack:function(e,a,d,b,c,g){void 0==g&&(g=1.70158);return 1>(a/=c/2)?b/2*a*a*(((g*=1.525)+1)*a-g)+d:b/2*((a-=2)*a*(((g*=1.525)+1)*a+g)+2)+d},easeInBounce:function(e,a,d,b,c){return b-jQuery.easing.easeOutBounce(e,c-a,0,b,c)+d},easeOutBounce:function(e,a,d,b,c){return(a/=c)<1/2.75?7.5625*b*a*a+d:a<2/2.75?b*(7.5625*(a-=1.5/2.75)*a+.75)+d:a<2.5/2.75?b*
(7.5625*(a-=2.25/2.75)*a+.9375)+d:b*(7.5625*(a-=2.625/2.75)*a+.984375)+d},easeInOutBounce:function(e,a,d,b,c){return a<c/2?.5*jQuery.easing.easeInBounce(e,2*a,0,b,c)+d:.5*jQuery.easing.easeOutBounce(e,2*a-c,0,b,c)+.5*b+d}});
(function(e){function a(){}function d(a){t=[a]}function b(a,f,m){return a&&a.apply(f.context||f,m)}function c(c){function v(a){A++||(B(),C&&(m[q]={s:[a]}),G&&(a=G.apply(c,[a])),b(k,c,[a,"success",c]),b(x,c,[c,"success"]))}function n(a){A++||(B(),C&&"timeout"!=a&&(m[q]=a),b(r,c,[c,a]),b(x,c,[c,a]))}c=e.extend({},H,c);var k=c.success,r=c.error,x=c.complete,G=c.dataFilter,D=c.callbackParameter,I=c.callback,L=c.cache,C=c.pageCache,J=c.charset,q=c.url,w=c.data,K=c.timeout,E,A=0,B=a,p,y,F;h&&h(function(a){a.done(k).fail(r);
k=a.resolve;r=a.reject}).promise(c);c.abort=function(){!A++&&B()};if(!1===b(c.beforeSend,c,[c])||A)return c;q=q||"";w=w?"string"==typeof w?w:e.param(w,c.traditional):"";q+=w?(/\?/.test(q)?"&":"?")+w:"";D&&(q+=(/\?/.test(q)?"&":"?")+encodeURIComponent(D)+"=?");L||C||(q+=(/\?/.test(q)?"&":"?")+"_"+(new Date).getTime()+"=");q=q.replace(/=\?(&|$)/,"="+I+"$1");C&&(E=m[q])?E.s?v(E.s[0]):n(E):(g[I]=d,p=e("<script>")[0],p.id="_jqjsp"+f++,J&&(p.charset=J),z&&11.6>z.version()?(y=e("<script>")[0]).text="document.getElementById('"+
p.id+"').onerror()":p.async="async",s&&(p.htmlFor=p.id,p.event="onclick"),p.onload=p.onerror=p.onreadystatechange=function(a){if(!p.readyState||!/i/.test(p.readyState)){try{p.onclick&&p.onclick()}catch(f){}a=t;t=0;a?v(a[0]):n("error")}},p.src=q,B=function(a){F&&clearTimeout(F);p.onreadystatechange=p.onload=p.onerror=null;l.removeChild(p);y&&l.removeChild(y)},l.insertBefore(p,D=l.firstChild),y&&l.insertBefore(y,D),F=0<K&&setTimeout(function(){n("timeout")},K));return c}var g=window,h=e.Deferred,l=
e("head")[0]||document.documentElement,m={},f=0,t,H={callback:"_jqjsp",url:location.href},z=g.opera,s=!!e("<div>").html("\x3c!--[if IE]><i><![endif]--\x3e").find("i").length;c.setup=function(a){e.extend(H,a)};e.jsonp=c})(jQuery);this.JSON||(this.JSON={});
(function(){function e(a){return 10>a?"0"+a:a}function a(a){c.lastIndex=0;return c.test(a)?'"'+a.replace(c,function(a){var f=l[a];return"string"===typeof f?f:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function d(f,c){var b,e,s,u,v=g,n,k=c[f];k&&"object"===typeof k&&"function"===typeof k.toJSON&&(k=k.toJSON(f));"function"===typeof m&&(k=m.call(c,f,k));switch(typeof k){case "string":return a(k);case "number":return isFinite(k)?String(k):"null";case "boolean":case "null":return String(k);
case "object":if(!k)return"null";g+=h;n=[];if("[object Array]"===Object.prototype.toString.apply(k)){u=k.length;for(b=0;b<u;b+=1)n[b]=d(b,k)||"null";s=0===n.length?"[]":g?"[\n"+g+n.join(",\n"+g)+"\n"+v+"]":"["+n.join(",")+"]";g=v;return s}if(m&&"object"===typeof m)for(u=m.length,b=0;b<u;b+=1)e=m[b],"string"===typeof e&&(s=d(e,k))&&n.push(a(e)+(g?": ":":")+s);else for(e in k)Object.hasOwnProperty.call(k,e)&&(s=d(e,k))&&n.push(a(e)+(g?": ":":")+s);s=0===n.length?"{}":g?"{\n"+g+n.join(",\n"+g)+"\n"+
v+"}":"{"+n.join(",")+"}";g=v;return s}}"function"!==typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(a){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+e(this.getUTCMonth()+1)+"-"+e(this.getUTCDate())+"T"+e(this.getUTCHours())+":"+e(this.getUTCMinutes())+":"+e(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(a){return this.valueOf()});var b=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
c=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,g,h,l={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},m;"function"!==typeof JSON.stringify&&(JSON.stringify=function(a,b,c){var e;h=g="";if("number"===typeof c)for(e=0;e<c;e+=1)h+=" ";else"string"===typeof c&&(h=c);if((m=b)&&"function"!==typeof b&&("object"!==typeof b||"number"!==typeof b.length))throw Error("JSON.stringify");return d("",{"":a})});
"function"!==typeof JSON.parse&&(JSON.parse=function(a,c){function m(a,f){var b,e,d=a[f];if(d&&"object"===typeof d)for(b in d)Object.hasOwnProperty.call(d,b)&&(e=m(d,b),void 0!==e?d[b]=e:delete d[b]);return c.call(a,f,d)}var e;a=String(a);b.lastIndex=0;b.test(a)&&(a=a.replace(b,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return e=eval("("+a+")"),"function"===typeof c?m({"":e},""):e;throw new SyntaxError("JSON.parse");})})();
(function(e){e.tools=e.tools||{version:"2013-02-15"};var a=e.tools.expose={conf:{maskId:"exposeMask",loadSpeed:"slow",closeSpeed:"fast",zIndex:9998,opacity:.8,startOpacity:0,color:"#fff"}},d,b,c,g,h;e.mask={load:function(l,m){if(c)return this;l=l||g;g=l=e.extend(e.extend({},a.conf),l);d=e("#"+l.maskId);d.length||(d=e("<div/>").attr("id",l.maskId),e("body").append(d));d.css({position:"fixed",top:0,left:0,width:"100%",height:"100%",display:"block",opacity:l.opacity,zIndex:l.zIndex,backgroundColor:l.color});
m&&m.length&&(h=m.eq(0).css("zIndex"),b=m.css({zIndex:Math.max(l.zIndex+1,"auto"==h?0:h)}));c=!0;return this},close:function(){c&&(d.fadeOut(g.closeSpeed,function(){b&&b.css({zIndex:h})}),c=!1);return this}};e.fn.mask=function(a){e.mask.load(a);return this};e.fn.expose=function(a){e.mask.load(a,this);return this}})(jQuery);
!function(e){function a(a,f){f=f||[];return a.replace(/(%[s])/g,function(a,b,c){return(a=f.shift())||0===a?a+"":""})}function d(){this.timer=this.documentTitle=this.instance=this.assemblyId=null;this._options={};this.uploads=[];this.results={};this.pollStarted=this.ended=null;this.pollRetries=0;this.started=!1;this.params=this.assembly=null;this.lastPoll=this.bytesReceivedBefore=0;this.$modal=this.$iframe=this.$fileClones=this.$files=this.$form=this.$params=null;this._clockseq=this._lastNSecs=this._lastMSecs=
0;this._uploadFileIds=[];this._resultFileIds=[]}var b="https:"==document.location.protocol?"https://":"http://",c=b+"api2.transloadit.com/",g={service:c,assets:b+"assets.transloadit.com/",beforeStart:function(){return!0},onFileSelect:function(){},onStart:function(){},onProgress:function(){},onUpload:function(){},onResult:function(){},onCancel:function(){},onError:function(){},onSuccess:function(){},interval:2500,pollTimeout:8E3,poll404Retries:15,pollConnectionRetries:3,wait:!1,processZeroFiles:!0,
triggerUploadOnFileSelection:!1,autoSubmit:!0,modal:!0,exclude:"",fields:!1,params:null,signature:null,region:"us-east-1",debug:!0,locale:"en"},h={en:{"errors.BORED_INSTANCE_ERROR":"Could not find a bored instance.","errors.CONNECTION_ERROR":"There was a problem connecting to the upload server","errors.unknown":"There was an internal error.","errors.tryAgain":"Please try your upload again.","errors.troubleshootDetails":"If you would like our help to troubleshoot this, please email us this information:",
cancel:"Cancel",details:"Details",startingUpload:"Starting upload ...",processingFiles:"Processing files",uploadProgress:"%s MB / %s MB (%s kB / sec)"}},l=!1;e.fn.transloadit=function(){var a=Array.prototype.slice.call(arguments),f,b;if(0!==this.length)if(1<this.length)this.each(function(){e.fn.transloadit.apply(e(this),a)});else{(1==a.length&&"object"==typeof a[0]||void 0===a[0])&&a.unshift("init");f=a.shift();"init"==f?(b=new d,a.unshift(this),this.data("transloadit.uploader",b)):b=this.data("transloadit.uploader");
if(!b)throw Error("Element is not initialized for transloadit!");f=b[f].apply(b,a);return void 0===f?this:f}};e.fn.transloadit.i18n=h;d.prototype.init=function(a,f){this.$form=a;this.options(e.extend({},g,f||{}));var b=this;a.bind("submit.transloadit",function(){b.validate();b.detectFileInputs();b._options.processZeroFiles||0!==b.$files.length?b._options.beforeStart()&&b.getBoredInstance():b._options.beforeStart()&&b.submitForm();return!1});if(this._options.triggerUploadOnFileSelection)a.on("change",
'input[type="file"]',function(){a.trigger("submit.transloadit")});a.on("change",'input[type="file"]',function(){b._options.onFileSelect(e(this).val(),e(this))});this.includeCss()};d.prototype.getBoredInstance=function(){function a(){e.jsonp({url:d,timeout:f._options.pollTimeout,callbackParameter:"callback",success:function(a){a.error?(f.ended=!0,a.url=d,f.renderError(a),f._options.onError(a)):(f.instance=a.api2_host,f.start())},error:function(e,h){if(g&&f._options.service===c)g=!1,f._findBoredInstanceUrl(function(c,
e){c?(f.ended=!0,c={error:"BORED_INSTANCE_ERROR",message:f.i18n("errors.BORED_INSTANCE_ERROR")+" "+c.message},f.renderError(c),f._options.onError(c)):(d=b+"api2."+e+"/instances/bored",a())});else{f.ended=!0;var u={error:"CONNECTION_ERROR",message:f.i18n("errors.CONNECTION_ERROR"),reason:"JSONP request status: "+h,url:d};f.renderError(u);f._options.onError(u)}}})}var f=this;this.instance=null;var d=this._options.service+"instances/bored",g=!0;a();this._options.modal&&this.showModal()};d.prototype._findBoredInstanceUrl=
function(a){var f=this,c=b+"s3.amazonaws.com/infra-"+this._options.region;e.ajax({url:c+".transloadit.com/cached_instances.json",datatype:"json",timeout:5E3,success:function(b){b=f._shuffle(b.uploaders);f._findResponsiveInstance(b,0,a)},error:function(f,b){a(Error("Could not query S3 for cached uploaders"))}})};d.prototype._findResponsiveInstance=function(a,f,c){if(!a[f])return c(Error("No responsive uploaders"));var d=this,z=a[f];e.jsonp({url:b+z,timeout:3E3,callbackParameter:"callback",success:function(a){c(null,
z)},error:function(b,e){d._findResponsiveInstance(a,f+1,c)}})};d.prototype._shuffle=function(a){for(var f=[],b,c=0;c<a.length;c++)b=Math.floor(Math.random()*(c+1)),f[c]=f[b],f[b]=a[c];return f};d.prototype.start=function(){var a=this;this.ended=this.started=!1;this.pollRetries=this.bytesReceivedBefore=0;this.uploads=[];this._uploadFileIds=[];this._resultFileIds=[];this.results={};this.assemblyId=this._genUuid();this.$fileClones=e().not(document);this.$files.each(function(){var b=e(this).clone(!0);
a.$fileClones=a.$fileClones.add(b);b.insertAfter(this)});this.$iframe=e('<iframe id="transloadit-'+this.assemblyId+'" name="transloadit-'+this.assemblyId+'"/>').appendTo("body").hide();var f=b+this.instance+"/assemblies/"+this.assemblyId+"?redirect=false";if(this._options.formData){this._options.formData.append("params",this.$form.find("input[name=params]").val());var c=new XMLHttpRequest;c.open("POST",f);c.send(this._options.formData)}else{this.$uploadForm=e('<form enctype="multipart/form-data" />').attr("action",
f).attr("target","transloadit-"+this.assemblyId).attr("method","POST").append(this.$files).appendTo("body").hide();f="[name=params], [name=signature]";!0===this._options.fields?f="*":"string"===typeof this._options.fields&&(f+=", "+this._options.fields);var d=this.$form.find(":input[type!=file]").filter(f),f=d.filter("select"),d=d.filter(function(){return!e(this).is("select")}),d=d.filter("[type!=submit]"),d=this.clone(d);this._options.params&&!this.$params&&(d=d.add('<input name="params" value=\''+
JSON.stringify(this._options.params)+"'>"));this._options.signature&&(d=d.add('<input name="signature" value=\''+this._options.signature+"'>"));if("object"==typeof this._options.fields)for(c in this._options.fields)d=d.add('<input name="'+c+"\" value='"+this._options.fields[c]+"'>");d.prependTo(this.$uploadForm);f.each(function(){e('<input type="hidden"/>').attr("name",e(this).attr("name")).attr("value",e(this).val()).prependTo(a.$uploadForm)});this.$uploadForm.submit()}this.lastPoll=+new Date;setTimeout(function(){a._poll()},
300)};d.prototype.clone=function(a){var b=a.clone();a=a.filter("textarea");for(var c=b.filter("textarea"),d=0;d<a.length;++d)e(c[d]).val(e(a[d]).val());return b};d.prototype.detectFileInputs=function(){var a=this.$form.find("input[type=file]").not(this._options.exclude);this._options.processZeroFiles||(a=a.filter(function(){return""!==this.value}));this.$files=a};d.prototype.validate=function(){if(this._options.params)this.params=this._options.params;else{var a=this.$form.find("input[name=params]");
if(!a.length){alert("Could not find input[name=params] in your form.");return}this.$params=a;try{this.params=JSON.parse(a.val())}catch(b){alert("Error: input[name=params] seems to contain invalid JSON.");return}}this.params.redirect_url?this.$form.attr("action",this.params.redirect_url):this._options.autoSubmit&&this.$form.attr("action")==this._options.service+"assemblies"&&alert("Error: input[name=params] does not include a redirect_url")};d.prototype._poll=function(a){var f=this;if(!this.ended){var c=
/(mozilla)(?:.*? rv:([\w.]+))?/.exec(navigator.userAgent),c=c&&c[1];this.documentTitle=document.title;c&&!this.documentTitle&&(document.title="Loading...");this.pollStarted=+new Date;var c=this.instance.replace(/\.transloadit\.com/,"")+"-status.transloadit.com",d=b+c+"/assemblies/"+this.assemblyId;a&&(d+=a);e.jsonp({url:d,timeout:f._options.pollTimeout,callbackParameter:"callback",success:function(a){if(!f.ended)if(f.assembly=a,"ASSEMBLY_NOT_FOUND"==a.error)f.pollRetries++,f.pollRetries>f._options.poll404Retries?
(document.title=f.documentTitle,f.ended=!0,f.renderError(a),f._options.onError(a)):setTimeout(function(){f._poll()},400);else if(a.error)f.ended=!0,f.renderError(a),document.title=f.documentTitle,f._options.onError(a);else{f.started||(f.started=!0,f._options.onStart(a));f.pollRetries=0;var b="ASSEMBLY_EXECUTING"===a.ok,c="ASSEMBLY_CANCELED"===a.ok,d="ASSEMBLY_COMPLETED"===a.ok;f._options.onProgress(a.bytes_received,a.bytes_expected,a);for(var e=0;e<a.uploads.length;e++){var m=a.uploads[e];-1===f._uploadFileIds.indexOf(m.id)&&
(f._options.onUpload(m,a),f.uploads.push(m),f._uploadFileIds.push(m.id))}for(var g in a.results)for(f.results[g]=f.results[g]||[],e=0;e<a.results[g].length;e++){var m=a.results[g][e],t=g+"_"+m.id;-1===f._resultFileIds.indexOf(t)&&(f._options.onResult(g,m,a),f.results[g].push(m),f._resultFileIds.push(t))}c?(f.ended=!0,document.title=f.documentTitle,f._options.onCancel(a)):(f.renderProgress(a),d||!f._options.wait&&b?(f.ended=!0,document.title=f.documentTitle,a.uploads=f.uploads,a.results=f.results,
f._options.onSuccess(a),f._options.modal&&f.cancel(),f.submitForm()):(a=f.pollStarted-+new Date,f.timer=setTimeout(function(){f._poll()},a<f._options.interval?f._options.interval:a),f.lastPoll=+new Date))}},error:function(a,b){if(!f.ended)if(f.pollRetries++,f.pollRetries>f._options.pollConnectionRetries){document.title=f.documentTitle;f.ended=!0;var c={error:"CONNECTION_ERROR",message:f.i18n("errors.CONNECTION_ERROR"),reason:"JSONP request status: "+b,url:d};f.renderError(c);f._options.onError(c)}else setTimeout(function(){f._poll()},
350)}})}};d.prototype.stop=function(){document.title=this.documentTitle;this.ended=!0};d.prototype.cancel=function(){if(!this.ended){var a=this;this.$params&&this.$params.prependTo(this.$form);this.$fileClones.each(function(b){b=e(a.$files[b]).clone(!0);var c=e(this);b.insertAfter(c);c.remove()});clearTimeout(a.timer);this._poll("?method=delete");"Microsoft Internet Explorer"==navigator.appName&&this.$iframe[0].contentWindow.document.execCommand("Stop");setTimeout(function(){a.$iframe.remove()},500)}this._options.modal&&
this.hideModal()};d.prototype.submitForm=function(){"multipart/form-data"===this.$form.attr("enctype")&&this.$form.removeAttr("enctype");null!==this.assembly&&e("<textarea/>").attr("name","transloadit").text(JSON.stringify(this.assembly)).prependTo(this.$form).hide();this._options.autoSubmit&&this.$form.unbind("submit.transloadit").submit()};d.prototype.hideModal=function(){e.mask.close();this.$modal.remove()};d.prototype.showModal=function(){this.$modal=e('<div id="transloadit"><div class="content"><a href="#close" class="close">'+
this.i18n("cancel")+'</a><p class="status"></p><div class="progress progress-striped active"><div class="bar"><span class="percent"></span></div></div><label>'+this.i18n("startingUpload")+'</label><p class="error"></p><div class="error-details-toggle"><a href="#">'+this.i18n("details")+'</a></div><p class="error-details"></p></div></div>').appendTo("body");e.extend(this.$modal,{$content:this.$modal.find(".content"),$close:this.$modal.find(".close"),$label:this.$modal.find("label"),$progress:this.$modal.find(".progress"),
$percent:this.$modal.find(".progress .percent"),$progressBar:this.$modal.find(".progress .bar"),$error:this.$modal.find(".error"),$errorDetails:this.$modal.find(".error-details"),$errorDetailsToggle:this.$modal.find(".error-details-toggle")});var a=this;this.$modal.$close.click(function(){a.cancel()});this.$modal.$error.hide();this.$modal.$errorDetails.hide();this.$modal.$errorDetailsToggle.hide();this.$modal.expose({api:!0,maskId:"transloadit_expose",opacity:.9,loadSpeed:250,closeOnEsc:!1,closeOnClick:!1});
this.$modal.$close.click(function(){a.cancel();return!1})};d.prototype.renderError=function(a){if(this._options.modal){if(!this._options.debug)return this.cancel();this.$modal.$content.addClass("content-error");this.$modal.$progress.hide();this.$modal.$label.hide();var c=a.error+": "+a.message+"<br /><br />",c=c+(a.reason||"");if(-1===["CONNECTION_ERROR","BORED_INSTANCE_ERROR","ASSEMBLY_NOT_FOUND"].indexOf(a.error))this.$modal.$error.html(c).show();else{var d=this.i18n("errors.unknown")+"<br/>"+this.i18n("errors.tryAgain");
this.$modal.$error.html(d).show();var g=a.assemblyId?a.assemblyId:this.assemblyId,h=this,l=null;e.getJSON(b+"jsonip.com/",function(a){l=a.ip}).always(function(){var d={endpoint:a.url,instance:h.instance,assembly_id:g,ip:l,time:h.getUTCDatetime(),agent:navigator.userAgent,poll_retries:h.pollRetries,error:c};e.post(b+"status.transloadit.com/client_error",d);var t=[],n;for(n in d)t.push(n+": "+d[n]);d=h.i18n("errors.troubleshootDetails")+"<br /><br />";h.$modal.$errorDetails.hide().html(d+t.join("<br />"));
h.$modal.$errorDetailsToggle.show().find("a").off("click").on("click",function(a){a.preventDefault();h.$modal.$errorDetails.toggle()})})}}};d.prototype.renderProgress=function(a){if(this._options.modal){var b=a.bytes_received/a.bytes_expected*100;100<b&&(b=0);var c=a.bytes_received-this.bytesReceivedBefore,d=+new Date-this.lastPoll,e=100===b?1E3:2*this._options.interval,g=this.i18n("processingFiles");100!=b&&(g=this.i18n("uploadProgress",(a.bytes_received/1024/1024).toFixed(2),(a.bytes_expected/1024/
1024).toFixed(2),(c/1024/(d/1E3)).toFixed(1)));this.$modal.$label.text(g);var h=parseInt(this.$modal.$progress.css("width"),10);this.bytesReceivedBefore=a.bytes_received;if(!(0>=c)){var l=this;this.$modal.$progressBar.stop().animate({width:b+"%"},{duration:e,easing:"linear",progress:function(a,b,c){a=(100*parseInt(l.$modal.$progressBar.css("width"),10)/h).toFixed(0);100<a&&(a=100);13<a&&l.$modal.$percent.text(a+"%")}})}}};d.prototype.includeCss=function(){!l&&this._options.modal&&(l=!0,e('<link rel="stylesheet" type="text/css" href="'+
this._options.assets+'css/transloadit2-latest.css" />').appendTo("head"))};d.prototype.getUTCDatetime=function(){var a=new Date,a=new Date(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate(),a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds()),b=function(a){return 10>a?"0"+a:a},c=a.getTimezoneOffset(),d=(0<c?"-":"+")+b(parseInt(c/60,10));0!==c%60&&(d+=b(c%60));0===c&&(d="Z");return a.getFullYear()+"-"+b(a.getMonth()+1)+"-"+b(a.getDate())+"T"+b(a.getHours())+":"+b(a.getMinutes())+":"+b(a.getSeconds())+
d};d.prototype._genUuid=function(a,b,c){function d(a,c){var b=c||0,e=n;return e[a[b++]]+e[a[b++]]+e[a[b++]]+e[a[b++]]+e[a[b++]]+e[a[b++]]+e[a[b++]]+e[a[b++]]+e[a[b++]]+e[a[b++]]+e[a[b++]]+e[a[b++]]+e[a[b++]]+e[a[b++]]+e[a[b++]]+e[a[b++]]}a=a||{};c=b&&c||0;var e=b||[],g=Array(16),h=function(){for(var a=0,b;16>a;a++)0===(a&3)&&(b=4294967296*Math.random()),g[a]=b>>>((a&3)<<3)&255;return g}(),l=[h[0]|1,h[1],h[2],h[3],h[4],h[5]];this._clockseq=(h[6]<<8|h[7])&16383;for(var h=null!=a.clockseq?a.clockseq:
this._clockseq,n=[],k=0;256>k;k++)n[k]=(k+256).toString(16).substr(1);var k=null!=a.msecs?a.msecs:(new Date).getTime(),r=null!=a.nsecs?a.nsecs:this._lastNSecs+1,x=k-this._lastMSecs+(r-this._lastNSecs)/1E4;0>x&&null==a.clockseq&&(h=h+1&16383);(0>x||k>this._lastMSecs)&&null==a.nsecs&&(r=0);if(1E4<=r)throw Error("uuid.v1(): Can't create more than 10M uuids/sec");this._lastMSecs=k;this._lastNSecs=r;this._clockseq=h;k+=122192928E5;r=(1E4*(k&268435455)+r)%4294967296;e[c++]=r>>>24&255;e[c++]=r>>>16&255;
e[c++]=r>>>8&255;e[c++]=r&255;k=k/4294967296*1E4&268435455;e[c++]=k>>>8&255;e[c++]=k&255;e[c++]=k>>>24&15|16;e[c++]=k>>>16&255;e[c++]=h>>>8|128;e[c++]=h&255;a=a.node||l;for(l=0;6>l;l++)e[c+l]=a[l];return b?b:d(e)};d.prototype.options=function(a){if(0===arguments.length)return this._options;e.extend(this._options,a)};d.prototype.option=function(a,b){if(1==arguments.length)return this._options[a];this._options[a]=b};d.prototype.i18n=function(){var b=Array.prototype.slice.call(arguments),c=b.shift(),
d=this._options.locale,d=h[d]&&h[d][c]||h.en[c];if(!d)throw Error("Unknown i18n key: "+c);return a(d,b)}}(window.jQuery);
