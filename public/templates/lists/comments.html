<%
  var member = this.app.profile.get('member');
  var gravatar = member ? 'https://www.gravatar.com/avatar/'
      + member.gravatar + '?s=32&d='
      + encodeURIComponent(this.app.cloudFrontURL + '/main/img/avatar_100.png')
      : null;
%>

<div id="comment_input">
  <% if (member) { %>
    <div class="comment">
      <a href="/<%= member.username %>" class="comment-avatar">
        <img src=<%= gravatar %> width="32" height="32" />
      </a>
      <div class="comment-body">
        <form enctype="multipart/form-data" method="POST" class="comment-input-form">
          <textarea name="body" class="comment-input" 
              placeholder="Write a comment ..."></textarea>
        </form>
      </div>
    </div>
  <% } else { %>
    <a href="/login">
      <span class="loading">Log in to comment.</span>
    </a>
  <% } %>
</div>
<% if (typeof loading !== 'undefined') { %>
  <!-- <span class="loading"></span> -->
<% } else if (this.collection.models.length === 0) { %>
  <!-- <span class="loading"></span> -->
<% } else { %>
  <% _.each(this.collection.models, _.bind(function(row) { %>
    <%= this.row(row) %>
  <% }, this)); %>
<% } %>